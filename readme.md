# 定检可视化模块说明书

## 1. 项目概述
- **项目目标**：打造一套覆盖桥梁定期检查计划、执行、监督、分析的全流程数字化监管平台，实现市、区两级主管部门对第三方检测单位的统一纳管。
- **设备背景**：核心终端为符合 GA/T 947-2015 标准的 JX-P2 执法记录仪（4G、音视频、定位三合一），同时兼容智能安全帽、对讲机等智能硬件。
- **多端布局**：
  - `Web 监管端（PC）`：集中展示监管大屏、任务管理、履约核查、报表分析。
- `运营管理端（Web/H5）`：检测单位进行人员设备管理、作业总览、数据审核。
- `移动巡检端（小程序 + H5 备选）`：检测人员现场选择项目包/路线/路段，开工打卡后尝试自动开启音视频与定位回传；若终端不支持自动推流，则提示人工开启。

## 2. 角色与使用场景
- 市级监管：跨区域监管总览、告警闭环、设备在线率监督。
- 区级监管：辖区任务编排、进度追踪、异常处理。
- 服务商管理员：人员排班、设备维护、现场数据审核。
- 定检人员：移动端接收任务、定位打卡、现场采集、语音/视频联动。
- 运维/数据团队：运行监控、数据分析、模型训练（后期）。

## 3. 核心功能模块
| 模块 | 子功能 | 终端 |
| --- | --- | --- |
| 设备与人员管理 | 设备登记/激活、人员档案、绑定关系、状态监控、维护记录 | Web |
| 作业打卡与执行 | 项目包/路线/路段选择、打卡、自动开视频、表单采集 | 小程序 |
| 实时音视频监督 | 视频墙、地图联动、语音对讲、指令记录 | Web / 小程序（辅助） |
| 定位与轨迹 | 实时定位、历史轨迹、合规校验 | Web / 小程序（本人） |
| 履约核查与告警 | 作业时长、轨迹比对、告警配置、闭环工单 | Web |
| 数据分析与报表 | KPI 看板、多维统计、导出 | Web |
| 系统与权限 | 多级角色、数据权限、日志审计、参数配置 | Web |

## 4. 多端体验规划
### 4.1 PC Web 监管端
- 实时地图：按市/区/桥梁维度切换。
- 视频墙与对讲：支持 WebRTC/RTMP，含喊话、云台控制。
- 任务运营：计划列表、审批流、里程碑视图。
- 告警中心：规则配置、消息通知（短信/邮件可扩展）。
- 数据驾驶舱：完成率、告警闭环率、设备在线率等 KPI。

### 4.2 小程序巡检端
- **登录与身份校验**：支持企业微信/短信验证码登录，设备 SN 绑定校验。
- **开工打卡**：现场选择项目包 → 路线 → 路段，系统校验合法性并尝试自动开启视频推流；若终端不支持自动推流，则提示在设备上手动开启。
- **实时回传**：打卡后持续上传定位（GPS/北斗，默认 10 秒一次）、音视频、设备状态；弱网自动缓存补传。
- **现场采集**：标准表单、照片、短视频、语音备注、一键求援。
- **收工打卡**：结束视频流，提交作业总结，异常情况可附整改说明。
- **消息提醒**：告警通知、指令回复、作业提示。

### 4.3 运营管理端（Web/H5）
- 作业总览、设备库存管理、人员资质档案、现场数据审核。
- 支持在平板或大屏展示，提供自定义统计和导出。

## 5. 技术架构建议
- **前端**：React + TypeScript，Ant Design Pro（PC）；Taro/uni-app 或原生微信小程序（移动端）；共享组件库与主题。
- **移动端能力层**：封装定位、相机、对讲、文件上传等 SDK，提供统一 TypeScript 接口；弱网缓存与重传策略。
- **后端**：Spring Boot / NestJS 微服务，服务拆分为设备管理、任务调度、轨迹服务、告警服务、音视频服务、权限服务。
- **数据层**：PostgreSQL（业务数据）、TimescaleDB 或 InfluxDB（轨迹）、对象存储（视频/图片）、ElasticSearch（日志/检索）。
- **消息与流媒体**：Kafka/RabbitMQ（事件流），WebRTC Server / RTMP 转推，支持 HLS 备用方案。
- **认证与权限**：OAuth2 + 多因素登录；细粒度 RBAC + ABAC。
- **运维监控**：Prometheus + Grafana，集中日志（ELK/EFK），链路追踪（SkyWalking/Jaeger）。

## 6. API 规划（示例）
- `POST /api/auth/login`：多因子登录。
- `GET /api/devices`：设备列表（支持状态过滤）。
- `POST /api/tasks`：创建定检任务。
- `POST /api/tasks/{taskId}/check-in`：人员打卡（小程序）。
- `GET /api/tracks`：轨迹查询（分页、时间段）。
- `POST /api/alerts/{alertId}/ack`：告警确认。
- `GET /api/reports/export`：报表导出，支持异步任务。

> 说明：接口需配合 API Gateway 提供统一鉴权，移动端请求需校验设备绑定关系与定位可信度。

## 7. 数据流程示意
1. 主管单位维护《项目包→路线→路段》及检查标准，对执行单位开放。
2. 执行单位登记设备、绑定检测人员，确保设备状态正常。
3. 检测人员现场打卡，选择项目包/路线/路段，系统尝试自动开启视频与定位回传；若终端不支持则提示人工开启。
4. 巡检过程中实时上报数据，弱网环境自动缓存补传。
5. 管理端大屏实时展示作业视频，支持语音对讲与异常告警。
6. 作业结束生成履约评估，沉淀数据用于统计分析与报表输出。

## 8. 合规与安全要求
- 定位、音视频数据全链路加密，存储采用分级访问控制。
- 对讲与视频回传遵循公安行业数据合规标准，提供访问审计。
- 提供敏感操作（告警关闭、权限分配）双人复核机制。
- 支持日志实时审计与异常行为监测。

## 9. 项目实施建议
- 阶段一：需求深化 & 原型设计，完成多端信息架构与 UI 草图。
- 阶段二：核心能力开发（设备、定位、视频、任务、告警），先上线监管端与基础小程序。
- 阶段三：联调测试与性能优化，引入弱网/高并发专项测试。
- 阶段四：试运行与运维交付，培训市、区监管及服务商人员。
- 阶段五（可选）：智能分析（履约评分模型、风险预测）。

## 10. 使用指南
1. 参考 `需求文档.md` 明确业务流程与设备约束。
2. 根据本说明书搭建基础服务与多端框架。
3. 优先完成账号体系、设备接入、任务流、打卡功能，满足多端协同。
4. 通过持续集成管线接入代码质量与监控告警。
5. 定期更新本说明书，记录新功能、接口变更、部署策略。

---

> 本说明书需在每次功能设计或实现完善后同步维护，确保非技术用户亦能快速理解与使用。


需求文档和页面规划在实际编码过程中有所调整，但未完全回滚修改文档。